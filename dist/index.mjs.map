{"version":3,"file":"index.mjs","sources":["../node_modules/mitt/dist/mitt.mjs","../index.ts"],"sourcesContent":["export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i?i.push(e):n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var i=n.get(t);i&&i.slice().map(function(n){n(e)}),(i=n.get(\"*\"))&&i.slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.mjs.map\n","/**\n * @source https://github.com/artemsites/dom\n * @source https://gitverse.ru/artemsites/dom\n *\n * @api:\n * createScope - creating an object in the DOM for working with the library\n * ref - reactive state\n * data-class is an attribute of an HTML element for dynamic class management\n */\nimport mitt from \"mitt\";\n\ninterface ComponentInstance {\n    [key: string]: any;\n}\n\ninterface State {\n    value: any;\n}\n\ndeclare global {\n    interface Window {\n        [key: string]: any;\n    }\n}\n\nconst emitter = mitt();\n\nlet stateNamesHashes = new Map();\n\nexport function createScope(\n    scopeId: string,\n    scope: () => void,\n    alias: string = \"\"\n) {\n    const wrapper = document.getElementById(scopeId);\n\n    if (wrapper) {\n        const scopeInstance = scope();\n\n        handlerClassesReactive(wrapper, scopeInstance);\n\n        if (alias !== \"\") {\n            window[alias] = scopeInstance;\n        } else {\n            window[scopeId] = scopeInstance;\n        }\n    } else {\n        throw Error(\"Нет wrapper: #\" + scopeId);\n    }\n}\n\nexport function createComponent(wrapperClass: string, component: () => {}) {\n    const wrappers = document.getElementsByClassName(\n        wrapperClass\n    ) as HTMLCollection;\n    for (let $wrapper of wrappers) {\n        if ($wrapper) {\n            const componentInstance: ComponentInstance = component();\n            if (isObject(componentInstance)) {\n                // @note handle data-ref\n                const refsInDom = $wrapper.querySelectorAll(\n                    `[data-ref]`\n                ) as NodeListOf<HTMLElement>;\n                refsInDom.forEach(($refEl) => {\n                    const refName = $refEl.getAttribute(\"data-ref\");\n                    if (refName) {\n                        componentInstance[refName].value = $refEl;\n                    } else {\n                        console.warn(\"The data-ref name was not found in: \", $refEl);\n                    }\n                });\n\n                // @note handle data-click\n                const elClicks = $wrapper.querySelectorAll(\n                    `[data-click]`\n                ) as NodeListOf<HTMLElement>;\n                elClicks.forEach(($elOnClick) => {\n                    $elOnClick.addEventListener(\"click\", function (e) {\n                        let methodNameOnClick = $elOnClick.dataset.click;\n                        if (methodNameOnClick) {\n                            const methodOnClick = componentInstance[methodNameOnClick];\n                            methodOnClick();\n                        } else {\n                            console.warn(\n                                \"The name of the data-click method was not found in: \",\n                                $elOnClick\n                            );\n                        }\n                    });\n                });\n\n                // @note handle data-class\n                handlerClassesReactive($wrapper as HTMLElement, componentInstance);\n            }\n        } else {\n            throw Error(\"Нет wrapper: .\" + wrapperClass);\n        }\n    }\n}\n\nexport function ref(defaultValue: any): State {\n    const stateNameHash = `state_${crypto.randomUUID()}`;\n    let state: State = { value: defaultValue };\n\n    const proxyState = new Proxy<State>(state, {\n        set(stateTarget, prop, valueNew) {\n            if (prop === \"value\") {\n                if (stateTarget[\"value\"] !== valueNew) {\n                    stateTarget[\"value\"] = valueNew;\n                    emitter.emit(stateNameHash, stateTarget);\n                }\n                return true;\n            }\n            return false;\n        },\n    });\n\n    stateNamesHashes.set(proxyState, stateNameHash);\n\n    emitter.emit(stateNameHash, proxyState);\n\n    return proxyState;\n}\n\nfunction handlerClassesReactive($wrapper: HTMLElement, appInstance: any) {\n    if ($wrapper.dataset && $wrapper.dataset.class) {\n        handlerClassesReactiveSubFunc1($wrapper);\n    }\n\n    const $elementsWithDataClasses = $wrapper.querySelectorAll(\n        \"[data-class]\"\n    ) as NodeListOf<HTMLElement>;\n    $elementsWithDataClasses.forEach(($el) => {\n        handlerClassesReactiveSubFunc1($el);\n    });\n\n    function handlerClassesReactiveSubFunc1($el: HTMLElement) {\n        let jsonString = $el.dataset.class;\n        if (jsonString) {\n            $el.removeAttribute(\"data-class\");\n\n            let parsedJson;\n            try {\n                parsedJson = JSON.parse(jsonString);\n            } catch (error) {\n                console.error(\"Error at JSON string: \" + jsonString);\n                console.error(error);\n            }\n\n            if (Array.isArray(parsedJson)) {\n                for (let i in parsedJson) {\n                    let jsExpressionTernary = parsedJson[i];\n\n                    const regex = /(.+?)\\s*\\?\\s*(.+?)\\s*:\\s*(.+)/;\n                    const match = jsExpressionTernary.match(regex);\n\n                    let jsNameWithPrefix = match[1];\n                    const classNameTrue = match[2];\n                    const classNameFalse = match[3];\n                    const className = [classNameTrue, classNameFalse];\n\n                    handlerClassesReactiveSubFunc2($el, className, jsNameWithPrefix);\n                }\n            } else if (isObject(parsedJson)) {\n                for (let className in parsedJson) {\n                    let jsNameWithPrefix = parsedJson[className];\n\n                    handlerClassesReactiveSubFunc2($el, className, jsNameWithPrefix);\n                }\n            }\n        } else {\n            console.warn(\"The data-class JSON string was not found in: \", $el);\n        }\n    }\n\n    function handlerClassesReactiveSubFunc2(\n        $el: HTMLElement,\n        className: string | string[],\n        jsNameWithPrefix: string\n    ) {\n        let isRevertVal = false;\n        if (jsNameWithPrefix[0] === \"!\") {\n            isRevertVal = true;\n            jsNameWithPrefix = jsNameWithPrefix.slice(1);\n        }\n\n        let jsExpression = deleteWordPrefix(jsNameWithPrefix);\n\n        const isNotEqualExpression = jsExpression.includes(\"!=\");\n        const isEqualExpression = jsExpression.includes(\"==\");\n        if (isNotEqualExpression || isEqualExpression) {\n            if (isNotEqualExpression) {\n                const regex = /!=/;\n                const operator = \"!=\";\n                splitExpressionAndCompareAndUpdateClassesReactive(\n                    jsExpression,\n                    regex,\n                    operator,\n                    isRevertVal,\n                    className,\n                    $el\n                );\n            } else if (isEqualExpression) {\n                const regex = /==/;\n                const operator = \"==\";\n                splitExpressionAndCompareAndUpdateClassesReactive(\n                    jsExpression,\n                    regex,\n                    operator,\n                    isRevertVal,\n                    className,\n                    $el\n                );\n            }\n        } else {\n            const operator = \"==\";\n            const jsName = jsExpression;\n            const jsVal = true;\n            compareAndUpdateClassesReactive(\n                jsName,\n                jsVal,\n                operator,\n                isRevertVal,\n                className,\n                $el\n            );\n        }\n    }\n\n    function splitExpressionAndCompareAndUpdateClassesReactive(\n        jsExpression: any,\n        regex: any,\n        operator: any,\n        isRevertVal: any,\n        className: any,\n        $el: any\n    ) {\n        const res = splitExpression(jsExpression, regex);\n        if (res && res.length === 2) {\n            const [jsName, jsVal] = res;\n            compareAndUpdateClassesReactive(\n                jsName,\n                jsVal,\n                operator,\n                isRevertVal,\n                className,\n                $el\n            );\n        }\n    }\n\n    function compareAndUpdateClassesReactive(\n        jsName: any,\n        jsVal: any,\n        operator: any,\n        isRevertVal: any,\n        className: any,\n        $el: any\n    ) {\n        const state = appInstance[jsName];\n        const isTrue = compare(state.value, jsVal, operator);\n\n        toggleClass(isTrue, className, $el, isRevertVal);\n        const stateNameHash = stateNamesHashes.get(state);\n\n        emitter.on(stateNameHash, (newState: any) => {\n            const isTrue = compare(newState.value, jsVal, operator);\n            toggleClass(isTrue, className, $el, isRevertVal);\n        });\n    }\n\n    function toggleClass(\n        value: any,\n        className: string | string[],\n        where: HTMLElement,\n        isRevertVal = false\n    ) {\n        try {\n            const isTrue = (value && !isRevertVal) || (!value && isRevertVal);\n            if (typeof className === \"string\") {\n                if (isTrue) {\n                    where.classList.add(className);\n                } else {\n                    where.classList.remove(className);\n                }\n            } else if (Array.isArray(className)) {\n                const [classIfTrue, classIfFalse] = className;\n                if (isTrue) {\n                    where.classList.remove(classIfFalse);\n                    where.classList.add(classIfTrue);\n                } else {\n                    where.classList.remove(classIfTrue);\n                    where.classList.add(classIfFalse);\n                }\n            }\n        } catch (error) {\n            console.error(error);\n        }\n    }\n}\n\n// @note tools:\nfunction isObject(value: any) {\n    return value !== null && typeof value === \"object\";\n}\n\nfunction deleteWordPrefix(strWithprefixWithDot: string) {\n    return strWithprefixWithDot.replace(/^\\w+\\./, \"\");\n}\n\nfunction splitExpression(\n    expression: string,\n    regex: RegExp\n): [string, string] | null {\n    const parts = expression.split(regex);\n\n    if (parts.length === 2) {\n        return [parts[0].trim(), parts[1].trim()];\n    }\n\n    return null;\n}\n\nfunction compare(value1: any, value2: any, operator: string) {\n    switch (operator) {\n        case \"!=\":\n            return value1 != value2;\n        case \"==\":\n            return value1 == value2;\n        case \"<\":\n            return value1 < value2;\n        case \">\":\n            return value1 > value2;\n        case \"<=\":\n            return value1 <= value2;\n        case \">=\":\n            return value1 >= value2;\n        default:\n            throw new Error(\"Invalid operator\");\n    }\n}\n"],"names":["mitt","n","e","i","emitter","stateNamesHashes","createScope","scopeId","scope","alias","wrapper","scopeInstance","handlerClassesReactive","createComponent","wrapperClass","component","wrappers","$wrapper","componentInstance","isObject","$refEl","refName","$elOnClick","methodNameOnClick","methodOnClick","ref","defaultValue","stateNameHash","state","proxyState","stateTarget","prop","valueNew","appInstance","handlerClassesReactiveSubFunc1","$el","jsonString","parsedJson","error","jsExpressionTernary","regex","match","jsNameWithPrefix","classNameTrue","classNameFalse","handlerClassesReactiveSubFunc2","className","isRevertVal","jsExpression","deleteWordPrefix","isNotEqualExpression","isEqualExpression","splitExpressionAndCompareAndUpdateClassesReactive","compareAndUpdateClassesReactive","operator","res","splitExpression","jsName","jsVal","isTrue","compare","toggleClass","newState","value","where","classIfTrue","classIfFalse","strWithprefixWithDot","expression","parts","value1","value2"],"mappings":"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","x_google_ignoreList":[0]}